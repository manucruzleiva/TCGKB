<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Grayscale Icons for Staging</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .instructions {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #2196f3;
    }
    .step {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #1976d2;
    }
    input[type="file"] {
      margin: 10px 0;
    }
    canvas {
      border: 1px solid #ddd;
      margin: 10px 0;
    }
    .preview {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .preview-item {
      text-align: center;
    }
    .preview-item img {
      max-width: 200px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¨ Create Grayscale Icons for Staging</h1>

    <div class="instructions">
      <strong>ðŸ“‹ Instructions:</strong>
      <ol>
        <li>Select icon-192.png from <code>frontend/public/icons/</code></li>
        <li>Click "Convert to Grayscale"</li>
        <li>Download as <code>icon-192-staging.png</code></li>
        <li>Repeat for icon-512.png</li>
        <li>Place the grayscale icons in <code>frontend/public/icons/</code></li>
      </ol>
    </div>

    <div class="step">
      <h3>Step 1: Select Icon</h3>
      <input type="file" id="iconInput" accept="image/png" />
    </div>

    <div class="step">
      <h3>Step 2: Convert</h3>
      <button id="convertBtn" disabled>Convert to Grayscale</button>
    </div>

    <div class="step">
      <h3>Step 3: Preview & Download</h3>
      <div class="preview">
        <div class="preview-item">
          <h4>Original</h4>
          <canvas id="originalCanvas"></canvas>
        </div>
        <div class="preview-item">
          <h4>Grayscale</h4>
          <canvas id="grayscaleCanvas"></canvas>
        </div>
      </div>
      <button id="downloadBtn" style="display: none;">Download Grayscale Icon</button>
    </div>
  </div>

  <script>
    const iconInput = document.getElementById('iconInput');
    const convertBtn = document.getElementById('convertBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const originalCanvas = document.getElementById('originalCanvas');
    const grayscaleCanvas = document.getElementById('grayscaleCanvas');

    let originalImage = null;
    let fileName = '';

    iconInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      fileName = file.name.replace('.png', '-staging.png');

      const reader = new FileReader();
      reader.onload = (event) => {
        originalImage = new Image();
        originalImage.onload = () => {
          // Draw original
          originalCanvas.width = originalImage.width;
          originalCanvas.height = originalImage.height;
          const ctx = originalCanvas.getContext('2d');
          ctx.drawImage(originalImage, 0, 0);

          convertBtn.disabled = false;
        };
        originalImage.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    convertBtn.addEventListener('click', () => {
      if (!originalImage) return;

      // Create grayscale version
      grayscaleCanvas.width = originalImage.width;
      grayscaleCanvas.height = originalImage.height;
      const ctx = grayscaleCanvas.getContext('2d');

      // Draw original image
      ctx.drawImage(originalImage, 0, 0);

      // Get image data
      const imageData = ctx.getImageData(0, 0, grayscaleCanvas.width, grayscaleCanvas.height);
      const data = imageData.data;

      // Convert to grayscale
      for (let i = 0; i < data.length; i += 4) {
        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
        data[i] = gray;     // Red
        data[i + 1] = gray; // Green
        data[i + 2] = gray; // Blue
        // data[i + 3] is alpha, keep unchanged
      }

      // Put the modified image data back
      ctx.putImageData(imageData, 0, 0);

      downloadBtn.style.display = 'inline-block';
    });

    downloadBtn.addEventListener('click', () => {
      grayscaleCanvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);
      });
    });
  </script>
</body>
</html>
